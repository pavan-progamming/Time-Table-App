{"ast":null,"code":"import { LocalNotifications } from '@capacitor/local-notifications';\nclass NotificationService {\n  async requestPermissions() {\n    const {\n      display\n    } = await LocalNotifications.requestPermissions();\n    return display === 'granted';\n  }\n  async scheduleClassReminders(timetable) {\n    try {\n      // First clear all existing notifications to avoid duplicates\n      const pending = await LocalNotifications.getPending();\n      if (pending.notifications.length > 0) {\n        await LocalNotifications.cancel(pending);\n      }\n      const schedule = [];\n      const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\n      const todayIndex = new Date().getDay();\n      timetable.forEach(item => {\n        if (item.is_completed) return;\n        const [hours, minutes] = item.start_time.split(':').map(Number);\n        const itemDayIndex = days.indexOf(item.day);\n        if (itemDayIndex === -1) return;\n\n        // Calculate how many days from today this class is\n        let daysAway = itemDayIndex - todayIndex;\n        if (daysAway < 0) daysAway += 7;\n\n        // Create a date object for the next occurrence\n        const notificationDate = new Date();\n        notificationDate.setDate(notificationDate.getDate() + daysAway);\n        notificationDate.setHours(hours, minutes, 0, 0);\n\n        // Apply alert offset (e.g. 5 mins before)\n        const offsetMinutes = item.alert_offset || 0;\n        notificationDate.setMinutes(notificationDate.getMinutes() - offsetMinutes);\n\n        // If the time already passed for today, schedule it for next week\n        if (notificationDate < new Date()) {\n          notificationDate.setDate(notificationDate.getDate() + 7);\n        }\n        schedule.push({\n          title: `Class Reminder: ${item.subject}`,\n          body: `Your class starts in ${offsetMinutes} minutes at ${item.location || 'unspecified location'}.`,\n          id: Math.floor(Math.random() * 1000000),\n          schedule: {\n            at: notificationDate\n          },\n          sound: 'default',\n          attachments: [],\n          actionTypeId: '',\n          extra: null\n        });\n      });\n      if (schedule.length > 0) {\n        await LocalNotifications.schedule({\n          notifications: schedule.slice(0, 50) // Capacitor has a limit on some platforms\n        });\n      }\n    } catch (error) {\n      console.error('Failed to schedule notifications:', error);\n    }\n  }\n  async notifyImmediately(title, body) {\n    await LocalNotifications.schedule({\n      notifications: [{\n        title,\n        body,\n        id: Math.floor(Math.random() * 1000000),\n        schedule: {\n          at: new Date(Date.now() + 1000)\n        },\n        sound: 'default'\n      }]\n    });\n  }\n}\nexport default new NotificationService();","map":{"version":3,"names":["LocalNotifications","NotificationService","requestPermissions","display","scheduleClassReminders","timetable","pending","getPending","notifications","length","cancel","schedule","days","todayIndex","Date","getDay","forEach","item","is_completed","hours","minutes","start_time","split","map","Number","itemDayIndex","indexOf","day","daysAway","notificationDate","setDate","getDate","setHours","offsetMinutes","alert_offset","setMinutes","getMinutes","push","title","subject","body","location","id","Math","floor","random","at","sound","attachments","actionTypeId","extra","slice","error","console","notifyImmediately","now"],"sources":["D:/time table/frontend/src/services/NotificationService.js"],"sourcesContent":["import { LocalNotifications } from '@capacitor/local-notifications';\r\n\r\nclass NotificationService {\r\n    async requestPermissions() {\r\n        const { display } = await LocalNotifications.requestPermissions();\r\n        return display === 'granted';\r\n    }\r\n\r\n    async scheduleClassReminders(timetable) {\r\n        try {\r\n            // First clear all existing notifications to avoid duplicates\r\n            const pending = await LocalNotifications.getPending();\r\n            if (pending.notifications.length > 0) {\r\n                await LocalNotifications.cancel(pending);\r\n            }\r\n\r\n            const schedule = [];\r\n            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\r\n            const todayIndex = new Date().getDay();\r\n\r\n            timetable.forEach((item) => {\r\n                if (item.is_completed) return;\r\n\r\n                const [hours, minutes] = item.start_time.split(':').map(Number);\r\n                const itemDayIndex = days.indexOf(item.day);\r\n\r\n                if (itemDayIndex === -1) return;\r\n\r\n                // Calculate how many days from today this class is\r\n                let daysAway = itemDayIndex - todayIndex;\r\n                if (daysAway < 0) daysAway += 7;\r\n\r\n                // Create a date object for the next occurrence\r\n                const notificationDate = new Date();\r\n                notificationDate.setDate(notificationDate.getDate() + daysAway);\r\n                notificationDate.setHours(hours, minutes, 0, 0);\r\n\r\n                // Apply alert offset (e.g. 5 mins before)\r\n                const offsetMinutes = item.alert_offset || 0;\r\n                notificationDate.setMinutes(notificationDate.getMinutes() - offsetMinutes);\r\n\r\n                // If the time already passed for today, schedule it for next week\r\n                if (notificationDate < new Date()) {\r\n                    notificationDate.setDate(notificationDate.getDate() + 7);\r\n                }\r\n\r\n                schedule.push({\r\n                    title: `Class Reminder: ${item.subject}`,\r\n                    body: `Your class starts in ${offsetMinutes} minutes at ${item.location || 'unspecified location'}.`,\r\n                    id: Math.floor(Math.random() * 1000000),\r\n                    schedule: { at: notificationDate },\r\n                    sound: 'default',\r\n                    attachments: [],\r\n                    actionTypeId: '',\r\n                    extra: null\r\n                });\r\n            });\r\n\r\n            if (schedule.length > 0) {\r\n                await LocalNotifications.schedule({\r\n                    notifications: schedule.slice(0, 50) // Capacitor has a limit on some platforms\r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to schedule notifications:', error);\r\n        }\r\n    }\r\n\r\n    async notifyImmediately(title, body) {\r\n        await LocalNotifications.schedule({\r\n            notifications: [\r\n                {\r\n                    title,\r\n                    body,\r\n                    id: Math.floor(Math.random() * 1000000),\r\n                    schedule: { at: new Date(Date.now() + 1000) },\r\n                    sound: 'default'\r\n                }\r\n            ]\r\n        });\r\n    }\r\n}\r\n\r\nexport default new NotificationService();\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}