{"ast":null,"code":"import{LocalNotifications}from'@capacitor/local-notifications';class NotificationService{async requestPermissions(){const{display}=await LocalNotifications.requestPermissions();return display==='granted';}async scheduleClassReminders(timetable){try{// First clear all existing notifications to avoid duplicates\nconst pending=await LocalNotifications.getPending();if(pending.notifications.length>0){await LocalNotifications.cancel(pending);}const schedule=[];const days=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];const todayIndex=new Date().getDay();timetable.forEach(item=>{if(item.is_completed)return;const[hours,minutes]=item.start_time.split(':').map(Number);const itemDayIndex=days.indexOf(item.day);if(itemDayIndex===-1)return;// Calculate how many days from today this class is\nlet daysAway=itemDayIndex-todayIndex;if(daysAway<0)daysAway+=7;// Create a date object for the next occurrence\nconst notificationDate=new Date();notificationDate.setDate(notificationDate.getDate()+daysAway);notificationDate.setHours(hours,minutes,0,0);// Apply alert offset (e.g. 5 mins before)\nconst offsetMinutes=item.alert_offset||0;notificationDate.setMinutes(notificationDate.getMinutes()-offsetMinutes);// If the time already passed for today, schedule it for next week\nif(notificationDate<new Date()){notificationDate.setDate(notificationDate.getDate()+7);}schedule.push({title:\"Class Reminder: \".concat(item.subject),body:\"Your class starts in \".concat(offsetMinutes,\" minutes at \").concat(item.location||'unspecified location',\".\"),id:Math.floor(Math.random()*1000000),schedule:{at:notificationDate},sound:'default',attachments:[],actionTypeId:'',extra:null});});if(schedule.length>0){await LocalNotifications.schedule({notifications:schedule.slice(0,50)// Capacitor has a limit on some platforms\n});}}catch(error){console.error('Failed to schedule notifications:',error);}}async notifyImmediately(title,body){await LocalNotifications.schedule({notifications:[{title,body,id:Math.floor(Math.random()*1000000),schedule:{at:new Date(Date.now()+1000)},sound:'default'}]});}}export default new NotificationService();","map":{"version":3,"names":["LocalNotifications","NotificationService","requestPermissions","display","scheduleClassReminders","timetable","pending","getPending","notifications","length","cancel","schedule","days","todayIndex","Date","getDay","forEach","item","is_completed","hours","minutes","start_time","split","map","Number","itemDayIndex","indexOf","day","daysAway","notificationDate","setDate","getDate","setHours","offsetMinutes","alert_offset","setMinutes","getMinutes","push","title","concat","subject","body","location","id","Math","floor","random","at","sound","attachments","actionTypeId","extra","slice","error","console","notifyImmediately","now"],"sources":["D:/time table/frontend/src/services/NotificationService.js"],"sourcesContent":["import { LocalNotifications } from '@capacitor/local-notifications';\r\n\r\nclass NotificationService {\r\n    async requestPermissions() {\r\n        const { display } = await LocalNotifications.requestPermissions();\r\n        return display === 'granted';\r\n    }\r\n\r\n    async scheduleClassReminders(timetable) {\r\n        try {\r\n            // First clear all existing notifications to avoid duplicates\r\n            const pending = await LocalNotifications.getPending();\r\n            if (pending.notifications.length > 0) {\r\n                await LocalNotifications.cancel(pending);\r\n            }\r\n\r\n            const schedule = [];\r\n            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\r\n            const todayIndex = new Date().getDay();\r\n\r\n            timetable.forEach((item) => {\r\n                if (item.is_completed) return;\r\n\r\n                const [hours, minutes] = item.start_time.split(':').map(Number);\r\n                const itemDayIndex = days.indexOf(item.day);\r\n\r\n                if (itemDayIndex === -1) return;\r\n\r\n                // Calculate how many days from today this class is\r\n                let daysAway = itemDayIndex - todayIndex;\r\n                if (daysAway < 0) daysAway += 7;\r\n\r\n                // Create a date object for the next occurrence\r\n                const notificationDate = new Date();\r\n                notificationDate.setDate(notificationDate.getDate() + daysAway);\r\n                notificationDate.setHours(hours, minutes, 0, 0);\r\n\r\n                // Apply alert offset (e.g. 5 mins before)\r\n                const offsetMinutes = item.alert_offset || 0;\r\n                notificationDate.setMinutes(notificationDate.getMinutes() - offsetMinutes);\r\n\r\n                // If the time already passed for today, schedule it for next week\r\n                if (notificationDate < new Date()) {\r\n                    notificationDate.setDate(notificationDate.getDate() + 7);\r\n                }\r\n\r\n                schedule.push({\r\n                    title: `Class Reminder: ${item.subject}`,\r\n                    body: `Your class starts in ${offsetMinutes} minutes at ${item.location || 'unspecified location'}.`,\r\n                    id: Math.floor(Math.random() * 1000000),\r\n                    schedule: { at: notificationDate },\r\n                    sound: 'default',\r\n                    attachments: [],\r\n                    actionTypeId: '',\r\n                    extra: null\r\n                });\r\n            });\r\n\r\n            if (schedule.length > 0) {\r\n                await LocalNotifications.schedule({\r\n                    notifications: schedule.slice(0, 50) // Capacitor has a limit on some platforms\r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to schedule notifications:', error);\r\n        }\r\n    }\r\n\r\n    async notifyImmediately(title, body) {\r\n        await LocalNotifications.schedule({\r\n            notifications: [\r\n                {\r\n                    title,\r\n                    body,\r\n                    id: Math.floor(Math.random() * 1000000),\r\n                    schedule: { at: new Date(Date.now() + 1000) },\r\n                    sound: 'default'\r\n                }\r\n            ]\r\n        });\r\n    }\r\n}\r\n\r\nexport default new NotificationService();\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}