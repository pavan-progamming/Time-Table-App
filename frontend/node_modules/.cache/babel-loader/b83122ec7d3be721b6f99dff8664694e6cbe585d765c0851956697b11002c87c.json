{"ast":null,"code":"import _objectSpread from\"D:/time table/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{LocalNotifications}from'@capacitor/local-notifications';class NotificationService{async requestPermissions(){try{const{display}=await LocalNotifications.requestPermissions();return display==='granted';}catch(e){console.error('Permission request failed',e);return false;}}async scheduleClassReminders(timetable){let userName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'Pavan';try{// First clear all existing notifications to avoid duplicates\nconst pending=await LocalNotifications.getPending();if(pending.notifications.length>0){await LocalNotifications.cancel(pending);}const schedule=[];const days=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];const todayIndex=new Date().getDay();timetable.forEach(item=>{if(item.is_completed)return;const[hours,minutes]=item.start_time.split(':').map(Number);const itemDayIndex=days.indexOf(item.day);const repeatConfig=typeof item.repeat_config==='string'?JSON.parse(item.repeat_config):item.repeat_config||{type:'None'};if(itemDayIndex===-1&&repeatConfig.type!=='Daily')return;const now=new Date();let notificationDate=new Date();notificationDate.setHours(hours,minutes,0,0);// Apply alert offset (e.g. 5 mins before)\nconst offsetMinutes=item.alert_offset||0;notificationDate.setMinutes(notificationDate.getMinutes()-offsetMinutes);// Personalize body based on user request: \"pavan its 2pm it's time do dsa\"\nconst ampm=hours>=12?'pm':'am';const displayHour=hours%12||12;const timeString=\"\".concat(displayHour).concat(ampm);const body=\"\".concat(userName,\", it's \").concat(timeString,\"! It's time to do \").concat(item.subject,\".\");if(repeatConfig.type==='Daily'){// Daily notification\nif(notificationDate<now){notificationDate.setDate(notificationDate.getDate()+1);}schedule.push({title:\"\\u23F0 Time for \".concat(item.subject),body:body,id:Math.floor(Math.random()*1000000),schedule:{on:{hour:hours,minute:Math.max(0,minutes-offsetMinutes)},repeats:true,allowWhileIdle:true},sound:'default',extra:{type:'class_reminder'}});}else{// Weekly or One-time\nlet daysAway=itemDayIndex-todayIndex;if(daysAway<0)daysAway+=7;notificationDate.setDate(now.getDate()+daysAway);if(notificationDate<now){notificationDate.setDate(notificationDate.getDate()+7);}schedule.push({title:\"\\u23F0 Time for \".concat(item.subject),body:body,id:Math.floor(Math.random()*1000000),schedule:{at:notificationDate,repeats:repeatConfig.type==='Weekly',every:repeatConfig.type==='Weekly'?'week':undefined,allowWhileIdle:true},sound:'default',extra:{type:'class_reminder'}});}});if(schedule.length>0){// Ensure unique IDs\nconst uniqueSchedule=schedule.map((s,idx)=>_objectSpread(_objectSpread({},s),{},{id:idx+100}));await LocalNotifications.schedule({notifications:uniqueSchedule.slice(0,50)});}}catch(error){console.error('Failed to schedule notifications:',error);}}async notifyImmediately(title,body){await LocalNotifications.schedule({notifications:[{title,body,id:1,schedule:{at:new Date(Date.now()+1000)},sound:'default'}]});}}export default new NotificationService();","map":{"version":3,"names":["LocalNotifications","NotificationService","requestPermissions","display","e","console","error","scheduleClassReminders","timetable","userName","arguments","length","undefined","pending","getPending","notifications","cancel","schedule","days","todayIndex","Date","getDay","forEach","item","is_completed","hours","minutes","start_time","split","map","Number","itemDayIndex","indexOf","day","repeatConfig","repeat_config","JSON","parse","type","now","notificationDate","setHours","offsetMinutes","alert_offset","setMinutes","getMinutes","ampm","displayHour","timeString","concat","body","subject","setDate","getDate","push","title","id","Math","floor","random","on","hour","minute","max","repeats","allowWhileIdle","sound","extra","daysAway","at","every","uniqueSchedule","s","idx","_objectSpread","slice","notifyImmediately"],"sources":["D:/time table/frontend/src/services/NotificationService.js"],"sourcesContent":["import { LocalNotifications } from '@capacitor/local-notifications';\r\n\r\nclass NotificationService {\r\n    async requestPermissions() {\r\n        try {\r\n            const { display } = await LocalNotifications.requestPermissions();\r\n            return display === 'granted';\r\n        } catch (e) {\r\n            console.error('Permission request failed', e);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    async scheduleClassReminders(timetable, userName = 'Pavan') {\r\n        try {\r\n            // First clear all existing notifications to avoid duplicates\r\n            const pending = await LocalNotifications.getPending();\r\n            if (pending.notifications.length > 0) {\r\n                await LocalNotifications.cancel(pending);\r\n            }\r\n\r\n            const schedule = [];\r\n            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\r\n            const todayIndex = new Date().getDay();\r\n\r\n            timetable.forEach((item) => {\r\n                if (item.is_completed) return;\r\n\r\n                const [hours, minutes] = item.start_time.split(':').map(Number);\r\n                const itemDayIndex = days.indexOf(item.day);\r\n                const repeatConfig = typeof item.repeat_config === 'string' ? JSON.parse(item.repeat_config) : (item.repeat_config || { type: 'None' });\r\n\r\n                if (itemDayIndex === -1 && repeatConfig.type !== 'Daily') return;\r\n\r\n                const now = new Date();\r\n                let notificationDate = new Date();\r\n                notificationDate.setHours(hours, minutes, 0, 0);\r\n\r\n                // Apply alert offset (e.g. 5 mins before)\r\n                const offsetMinutes = item.alert_offset || 0;\r\n                notificationDate.setMinutes(notificationDate.getMinutes() - offsetMinutes);\r\n\r\n                // Personalize body based on user request: \"pavan its 2pm it's time do dsa\"\r\n                const ampm = hours >= 12 ? 'pm' : 'am';\r\n                const displayHour = hours % 12 || 12;\r\n                const timeString = `${displayHour}${ampm}`;\r\n                const body = `${userName}, it's ${timeString}! It's time to do ${item.subject}.`;\r\n\r\n                if (repeatConfig.type === 'Daily') {\r\n                    // Daily notification\r\n                    if (notificationDate < now) {\r\n                        notificationDate.setDate(notificationDate.getDate() + 1);\r\n                    }\r\n                    schedule.push({\r\n                        title: `⏰ Time for ${item.subject}`,\r\n                        body: body,\r\n                        id: Math.floor(Math.random() * 1000000),\r\n                        schedule: {\r\n                            on: { hour: hours, minute: Math.max(0, minutes - offsetMinutes) },\r\n                            repeats: true,\r\n                            allowWhileIdle: true\r\n                        },\r\n                        sound: 'default',\r\n                        extra: { type: 'class_reminder' }\r\n                    });\r\n                } else {\r\n                    // Weekly or One-time\r\n                    let daysAway = itemDayIndex - todayIndex;\r\n                    if (daysAway < 0) daysAway += 7;\r\n\r\n                    notificationDate.setDate(now.getDate() + daysAway);\r\n                    if (notificationDate < now) {\r\n                        notificationDate.setDate(notificationDate.getDate() + 7);\r\n                    }\r\n\r\n                    schedule.push({\r\n                        title: `⏰ Time for ${item.subject}`,\r\n                        body: body,\r\n                        id: Math.floor(Math.random() * 1000000),\r\n                        schedule: {\r\n                            at: notificationDate,\r\n                            repeats: repeatConfig.type === 'Weekly',\r\n                            every: repeatConfig.type === 'Weekly' ? 'week' : undefined,\r\n                            allowWhileIdle: true\r\n                        },\r\n                        sound: 'default',\r\n                        extra: { type: 'class_reminder' }\r\n                    });\r\n                }\r\n            });\r\n\r\n            if (schedule.length > 0) {\r\n                // Ensure unique IDs\r\n                const uniqueSchedule = schedule.map((s, idx) => ({ ...s, id: idx + 100 }));\r\n                await LocalNotifications.schedule({\r\n                    notifications: uniqueSchedule.slice(0, 50)\r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to schedule notifications:', error);\r\n        }\r\n    }\r\n\r\n    async notifyImmediately(title, body) {\r\n        await LocalNotifications.schedule({\r\n            notifications: [\r\n                {\r\n                    title,\r\n                    body,\r\n                    id: 1,\r\n                    schedule: { at: new Date(Date.now() + 1000) },\r\n                    sound: 'default'\r\n                }\r\n            ]\r\n        });\r\n    }\r\n}\r\n\r\nexport default new NotificationService();\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}